<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="torque-slide.html">
<link rel="import" href=" bower_components/paper-progress/paper-progress.html">
<polymer-element name='torque-slides' attributes='duration current countdown auto progress'>
  <template>
    <div vertical layout style="min-height: 100vh">
      <div flex class="flex-content">
        <shadow ></shadow>
      </div>
      <paper-progress style="width: 100%" min="0" max="{{list.length -1}}" value="{{counter}}" hidden?="{{!(progress && !auto)}}"></paper-progress>
      <paper-progress style="width: 100%" min="0" max="{{list[current].duration || duration}}" value="{{(list[current].duration || duration) - countdown}}" hidden?="{{!(progress && auto)}}"></paper-progress>
    </div>
  </template>
  <script>
    Polymer('torque-slides', {
      auto: false,
      progress: false,
      ready: function(){
        var self = this;
        window.addEventListener('polymer-ready', function(e) {
          self.list = self.querySelectorAll('torque-slides /deep/ torque-slide');
          for(var i = 1; i < self.list.length; i++) {
            self.list[i].hidden = true;
          }
          self.current = 0;
          self.countdown = self.list[0].duration || self.duration;

          if(self.auto) {
            setInterval(function(){ self.updateSlide(); }, 1000);
          } else  {
            document.addEventListener('keydown', function(e) {
              switch(event.keyCode) {
                case 37: self.prev(); break;
                case 39: self.next(); break;
              }
            });
          }
        });
      },
      currentChanged: function(oldValue, newValue) {
        this.counter = this.current;
        if(oldValue !== undefined) {
          this.list[oldValue].hidden = true;
        }
        if(newValue !== undefined) {
          this.list[newValue].hidden = false;
        }
      },
      updateSlide: function() {
        if(this.countdown === 0){
          this.current = (this.current + 1) % this.list.length;
          var current = this.list[this.current];
          this.countdown = current.duration || this.duration;
        } else {
          this.countdown -= 1;
        }
      },
      next: function() {
        if(this.current !== this.list.length - 1) {
          this.current += 1;
        }
      },
      prev: function() {
        if(this.current !== 0) {
          this.current -= 1;
        }
      }
    });
  </script>
</polymer-element>
